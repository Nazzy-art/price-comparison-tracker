<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Price Comparison Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.3/dist/tailwind.min.css" rel="stylesheet">
   
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body class="bg-gray-100">

<div class="container mx-auto py-10">
    <h1 class="text-3xl font-bold mb-6 text-center">Price Comparison Tracker</h1>

    <!-- Add Item Form -->
    <form id="addItemForm" class="bg-white p-6 rounded-lg shadow-md mb-6 space-y-4">
        <div>
            <label for="itemName" class="block font-medium mb-1">Item Name</label>
            <input type="text" id="itemName" class="w-full border px-4 py-2 rounded-lg">
        </div>
        <div>
            <label for="storeName" class="block font-medium mb-1">Store Name</label>
            <input type="text" id="storeName" class="w-full border px-4 py-2 rounded-lg">
        </div>
        <div>
            <label for="itemPrice" class="block font-medium mb-1">Price</label>
            <input type="number" step="0.01" id="itemPrice" class="w-full border px-4 py-2 rounded-lg">
        </div>
        <div>
            <label for="itemDate" class="block font-medium mb-1">Date</label>
            <input type="date" id="itemDate" class="w-full border px-4 py-2 rounded-lg">
        </div>
        <div>
            <label for="itemNotes" class="block font-medium mb-1">Notes</label>
            <textarea id="itemNotes" rows="2" class="w-full border px-4 py-2 rounded-lg"></textarea>
        </div>
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Add Item</button>
    </form>

    <!-- Filters -->
    <div class="flex flex-wrap gap-4 mb-6">
        <input type="text" id="filterItem" placeholder="Search by Item" class="border px-4 py-2 rounded-lg flex-1">
        <select id="filterStore" class="border px-4 py-2 rounded-lg">
            <option value="">All Stores</option>
        </select>
        <button id="filterCheapest" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Cheapest Only</button>
        <button id="resetFilters" class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400">Reset Filters</button>
    </div>

    <!-- Items Table -->
    <table class="w-full bg-white rounded-lg shadow-md overflow-hidden">
        <thead class="bg-gray-200">
            <tr>
                <th class="px-6 py-3 text-left">Item</th>
                <th class="px-6 py-3 text-left">Store</th>
                <th class="px-6 py-3 text-left">Price</th>
                <th class="px-6 py-3 text-left">Date</th>
                <th class="px-6 py-3 text-left">Notes</th>
                <th class="px-6 py-3 text-right">Actions</th>
            </tr>
        </thead>
        <tbody id="itemsTable">
            <tr><td colspan="6" class="text-center text-gray-500 py-4">No items yet</td></tr>
        </tbody>
    </table>

    <!-- Summary -->
    <div id="summaryContainer" class="mt-10 grid md:grid-cols-2 gap-4"></div>

    <!-- Edit Modal -->
    <div id="editModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-md">
            <h3 class="text-xl font-semibold mb-4">Edit Item</h3>
            <form id="editItemForm" class="space-y-4">
                <input type="hidden" id="editItemId">
                <div>
                    <label for="editItemName" class="block text-sm font-medium text-gray-700 mb-1">Item Name</label>
                    <input type="text" id="editItemName" class="w-full px-4 py-2 border rounded-lg">
                </div>
                <div>
                    <label for="editStoreName" class="block text-sm font-medium text-gray-700 mb-1">Store Name</label>
                    <input type="text" id="editStoreName" class="w-full px-4 py-2 border rounded-lg">
                </div>
                <div>
                    <label for="editItemPrice" class="block text-sm font-medium text-gray-700 mb-1">Price</label>
                    <input type="number" step="0.01" id="editItemPrice" class="w-full px-4 py-2 border rounded-lg">
                </div>
                <div>
                    <label for="editItemDate" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                    <input type="date" id="editItemDate" class="w-full px-4 py-2 border rounded-lg">
                </div>
                <div>
                    <label for="editItemNotes" class="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                    <textarea id="editItemNotes" rows="2" class="w-full px-4 py-2 border rounded-lg"></textarea>
                </div>
                <div class="flex justify-end space-x-2">
                    <button type="button" id="closeModal" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    AOS.init();
    feather.replace();

    // Firebase config & init
    const firebaseConfig = {
        apiKey: "AIzaSyB74SGKLTWSKSo0MBGPKGjHFnl4vOmSgVM",
        authDomain: "price-comparison-tracker.firebaseapp.com",
        projectId: "price-comparison-tracker",
        storageBucket: "price-comparison-tracker.appspot.com",
        messagingSenderId: "397842635078",
        appId: "1:397842635078:web:fb4c3bd9930d06fccaed47",
        measurementId: "G-P0H1SDW091"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // DOM elements
    const addItemForm = document.getElementById('addItemForm');
    const itemsTable = document.getElementById('itemsTable');
    const filterItem = document.getElementById('filterItem');
    const filterStore = document.getElementById('filterStore');
    const filterCheapest = document.getElementById('filterCheapest');
    const resetFilters = document.getElementById('resetFilters');
    const summaryContainer = document.getElementById('summaryContainer');
    const editModal = document.getElementById('editModal');
    const closeModal = document.getElementById('closeModal');
    const editItemForm = document.getElementById('editItemForm');

    let items = [];

    // Firestore snapshot
    db.collection('items').onSnapshot(snapshot => {
        items = [];
        snapshot.forEach(doc => {
            items.push({ id: doc.id, ...doc.data() });
        });
        renderItems();
    });

    function renderItems(filteredItems = items) {
        itemsTable.innerHTML = '';
        if (!filteredItems.length) {
            itemsTable.innerHTML = `<tr><td colspan="6" class="text-center text-gray-500 py-4">No items found</td></tr>`;
            summaryContainer.innerHTML = '<p class="text-gray-500">Add items to see price comparisons</p>';
            return;
        }

        const bestPrices = {};
        filteredItems.forEach(item => {
            if (!bestPrices[item.name] || item.price < bestPrices[item.name].price) bestPrices[item.name] = item;
        });

        filteredItems.forEach(item => {
            const isBestPrice = bestPrices[item.name] && bestPrices[item.name].price === item.price;
            const row = document.createElement('tr');
            row.className = isBestPrice ? 'bg-green-50' : '';
            row.innerHTML = `
                <td class="px-6 py-4 font-medium">${item.name}</td>
                <td class="px-6 py-4">${item.store}</td>
                <td class="px-6 py-4">$${item.price.toFixed(2)} ${isBestPrice ? '<span class="ml-2 px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full">Best</span>' : ''}</td>
                <td class="px-6 py-4">${item.date || '-'}</td>
                <td class="px-6 py-4 max-w-xs truncate">${item.notes || '-'}</td>
                <td class="px-6 py-4 text-right">
                    <button class="edit-btn" data-id="${item.id}" aria-label="Edit ${item.name}"><i data-feather="edit"></i></button>
                    <button class="delete-btn" data-id="${item.id}" aria-label="Delete ${item.name}"><i data-feather="trash-2"></i></button>
                </td>
            `;
            itemsTable.appendChild(row);
        });

        feather.replace();
        addEditDeleteListeners();
        renderStoreFilter();
        renderSummary();
    }

    function renderStoreFilter() {
        const stores = [...new Set(items.map(i => i.store))];
        filterStore.innerHTML = '<option value="">All Stores</option>';
        stores.forEach(store => {
            const option = document.createElement('option');
            option.value = store;
            option.textContent = store;
            filterStore.appendChild(option);
        });
    }

    function renderSummary() {
        summaryContainer.innerHTML = '';
        const itemsByName = {};
        items.forEach(i => { if (!itemsByName[i.name]) itemsByName[i.name] = []; itemsByName[i.name].push(i); });
        Object.entries(itemsByName).forEach(([name, arr]) => {
            const sorted = arr.sort((a,b)=>a.price-b.price);
            const cheapest = sorted[0], expensive = sorted[sorted.length-1];
            const diff = expensive.price - cheapest.price;
            const card = document.createElement('div');
            card.className='bg-white border border-gray-200 rounded-lg p-4 shadow-sm';
            card.innerHTML = `
                <h3 class="font-semibold text-lg mb-2">${name}</h3>
                <div>Best: $${cheapest.price.toFixed(2)} at ${cheapest.store}</div>
                <div>Price range: $${cheapest.price.toFixed(2)} - $${expensive.price.toFixed(2)} ${diff>0?`(+${diff.toFixed(2)})`:''}</div>
            `;
            summaryContainer.appendChild(card);
        });
    }

    async function addItem(item) { try { await db.collection('items').add(item); } catch(e){ alert(e.message); } }
    async function updateItem(id,data){ try { await db.collection('items').doc(id).update(data); } catch(e){ alert(e.message); } }
    async function deleteItemFirestore(id){ try { await db.collection('items').doc(id).delete(); } catch(e){ alert(e.message); } }

    addItemForm.addEventListener('submit', e=>{
        e.preventDefault();
        const newItem = {
            name: document.getElementById('itemName').value.trim(),
            store: document.getElementById('storeName').value.trim(),
            price: parseFloat(document.getElementById('itemPrice').value),
            date: document.getElementById('itemDate').value || new Date().toISOString().split('T')[0],
            notes: document.getElementById('itemNotes').value.trim()
        };
        addItem(newItem);
        addItemForm.reset();
    });

    filterItem.addEventListener('input', filterItems);
    filterStore.addEventListener('change', filterItems);
    filterCheapest.addEventListener('click', () => {
        const grouped = {};
        items.forEach(i => { if(!grouped[i.name]||i.price<grouped[i.name].price) grouped[i.name]=i; });
        renderItems(Object.values(grouped));
    });
    resetFilters.addEventListener('click', ()=>{ filterItem.value=''; filterStore.value=''; renderItems(); });

    function filterItems(){
        const search = filterItem.value.toLowerCase();
        const store = filterStore.value;
        const filtered = items.filter(i=>i.name.toLowerCase().includes(search)&&(!store||i.store===store));
        renderItems(filtered);
    }

    function addEditDeleteListeners(){
        document.querySelectorAll('.edit-btn').forEach(btn=>{
            btn.onclick=()=>{
                const id=btn.dataset.id;
                const item=items.find(i=>i.id===id);
                if(!item) return;
                document.getElementById('editItemId').value=id;
                document.getElementById('editItemName').value=item.name;
                document.getElementById('editStoreName').value=item.store;
                document.getElementById('editItemPrice').value=item.price;
                document.getElementById('editItemDate').value=item.date;
                document.getElementById('editItemNotes').value=item.notes||'';
                editModal.classList.remove('hidden');
            };
        });

        document.querySelectorAll('.delete-btn').forEach(btn=>{ btn.onclick=()=>{ if(confirm('Delete item?')) deleteItemFirestore(btn.dataset.id); }; });
    }

    closeModal.addEventListener('click', ()=> editModal.classList.add('hidden'));

    editItemForm.addEventListener('submit', e=>{
        e.preventDefault();
        const id=document.getElementById('editItemId').value;
        const data={
            name:document.getElementById('editItemName').value.trim(),
            store:document.getElementById('editStoreName').value.trim(),
            price:parseFloat(document.getElementById('editItemPrice').value),
            date:document.getElementById('editItemDate').value||new Date().toISOString().split('T')[0],
            notes:document.getElementById('editItemNotes').value.trim()
        };
        updateItem(id,data);
        editModal.classList.add('hidden');
    });

});
</script>
</body>
</html>

